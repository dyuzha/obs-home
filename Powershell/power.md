# PowerShell
---
Позволяет выполнять обычные команды
Дает доступ к объектам:
- COM
  это объектная архитектура программного обеспечения, которая позволяет создавать приложения из двоичных компонентов. COM не является языком программирования, а представляет собой спецификацию.
- WMI
  Объекты в WMI (Windows Management Instrumentation) — это данные об операционной системе, её свойствах, управляемых приложениях и обнаруженном оборудовании.
- ADSI
  Это COM-Объекты, предоставляющие данные к службе каталогов

В ней использованы специальные хранилища (вроде файловой системе и реестра Windows)
Для доступа к которым используются поставщики (**providers**)

```ps1
# Узнать версию
$PSVersionTable.PSVersion
Get-Variable -Name PSVersionTable –ValueOnly
```


## Возможности
---
**Windows PowerShell** позволяет:
- Менять настройки операционной системы;
- Управлять службами и процессами;
- Настраивать роли и компоненты сервера;
- Устанавливать программное обеспечение;
- Управлять установленным ПО через специальные интерфейсы;
- Встраивать исполняемые компоненты в сторонние программы;
- Создавать сценарии для автоматизации задач администрирования;
- Работать с файловой системой, реестром Windows, хранилищем сертификатов и т.д.


## Cmdlets (Командлеты)
---
- Специализированные классы .NET
Действие-Объект (Глагол-Существительное)
> [!Example]
```ps1
Get-Help    # Получить помощь - аналог man (Unix)
Add         # добавить
Clear       # очистить
Enable      # включить
Disable     # выключить
New         # создать
Remove      # удалить
Set         # задать
Start       # запустить
Stop        # остановить
Export      # экспортировать
Import      # импортировать

Get-Process # показать запущенные в системе процессы;
Get-Service # показать службы и их статус;
Get-Content # вывести содержимое файла.
Get-Alias   # вывести alis'ы

Get-ExecutionPolicy # Проверка текущих настроек
Get-ExecutionPolicy <value> # Выставить политику
```



### Виды командлетов
---
- Системные
- Пользовательские
- Опциональные

Группиовка по модулям:
- NetTCPIP
- HyperV
- ...

Все они возвращают - объект или массив объектов
Для разделения используется `;`

Поиск по объекту и действию осуществляется при помощи `Get-Command`


### Get-ExecutionPolicy
---
Выставляет политику выполнения сценариев
```ps1
Get-ExecutionPolicy # Проверка текущих настроек
Get-ExecutionPolicy <value> # Выставить политику
  Restricted # запуск сценариев запрещен (по умолчанию);
  AllSigned # разрешен только запуск подписанных доверенным разработчиком сценариев;
  RemoteSigned # разрешен запуск подписанных и собственных сценариев;
  Unrestricted # разрешен запуск любых сценариев.
```

## Модули
---
Модуль - сценарий с функциями (.psm1)
Модули должны храниться в каталогах, определенных в переменных окружения PowerShell
```ps1
# Посмотреть каталоги для функций
Get-ChildItem Env:\PSModulePath | Format-Table -AutoSize
```

## Конвейеры
---
Позволяют перенаправлять вывод (как в Unix-like)
В отличии от Unix-like перенаправляют не **текст** , а **объекты**
```ps1
Get-Service | Sort-Object -property Status
# Реализация постраничного вывода
Get-Service | Sort-Object -property Status | more
```

## Управление фоновыми задачами
---
```ps1
Start-Job 	# запуск фоновой задачи;
Stop-Job 		# остановка фоновой задачи;
Get-Job 		# просмотр списка фоновых задач;
Receive-Job # просмотр результата выполнения фоновой задачи;
Remove-Job 	# удаление фоновой задачи;
Wait-Job 		# перевод фоновой задачи обратно в консоль.

# Использование
Start-Job {Get-Service}
# В {} указывается команда или набор команд
```
Управлять задачами можно, зная их имя

```ps1
# просмотр списка фоновых задач
Get-Job

# Показать результат работы Job1
Receive-Job Job1 | more
```

## Удаленное управления командами
---
- У многих команд есть параметр `-ComputerName`, но таким способом не создать конвейер
- `-Enter-PSSession` позволяет создать на удаленной машине интерактивный сеанс
- `Invoke-Command` позволяет запускать команды на удаленных машинах



### Base
```ps1
$sessionParse=@() # Array create
```

### Invoke-Command
- позволяет выполнить программу на удаленном ПК

```ps1
Invoke-Command -ComputerName <pc_name> -ScriptBlock <execute_command>
```

>[!Example]
```ps1
$sessions = Invoke-Command -ComputerName 192.168.7.8 -ScriptBlock { query session }
```
