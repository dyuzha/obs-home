---
id: vm-set-graphic
aliases:
  - Настройки графики
tags: []
---

# Настройки графики
---

1. Виртуальная графика
```bash
qm set 100 --vga std
```

2. Физическая видеокарта
```bash
qm set 100 --vga none # Отключить виртуальную GPU
qm set 100 --hostpci0 01:00.0,pcie=1 # Подключаем реальную GPU
```


## Виртуальная GPU
---
| Name   | RAM default | Description                           |
|--------|-------------|---------------------------------------|
| std    | 16 mb       | Базовый, совместимый                  |
| vmware | 16 mb       | Vmware-совместимость                  |
| qxl    | 64 mb       | Ускоренная (SPICE), многомониторность |
| virtio | 16mb        | Эксперементальный                     |
| none   | -           | Нет графики                           |

### Ресурсы
---

Видео память - RAM хоста
```bash
qm set 100 --vga std --memory 4096
```

Вычислителная мощность - CPU хоста
- 2D-ускорение - QXL драйвер (частичная эмуляция)
- 3D-рендеринг - Чистая программная эмуляция (очень медленно)

Драйверы в гостевой ОС
**Windows**: cirrus, qxl, vmware драйверы
**Linux**: modesetting, qxl, virtio-gpu

## Реальная GPU
---

### Параметры
---

| name     | Description               |
|----------|---------------------------|
| `pcie=1` | PCI Express современный   |
| `x-vga=1`  | Пометить как основную GPU |
| `rombar=1` | Передать прошивку данных  |

*Для NVIDIA часто нужно rombar=0*

Например:
```bash
# NVIDIA карта на PCI Express как основная
qm set 100 --hostpci0 01:00.0,pcie=1,x-vga=1,rombar=0
```


### Найти видеокарту
---
```bash
lspci -nn | grep -E 'VGA|3D'
# 01:00.0 VGA [0300]: NVIDIA Corporation GA106 [10de:2503]
```

### Синтакси PCI адреса
```bash
01:00.0
│  │  │
│  │  └─── Функция (function) - 0
│  └───── Устройство (device) - 00
└─────── Шина (bus) - 01
```


## Кейсы
---
Gaming Case
```bash
# Отключаем виртуальную графику
qm set 100 --vga none

# Подключаем физическею видеокарту
qm set 100 --hostpci0 01:00.0,pcie=1,x-vga=1

# Добавляем аудио (часто на этой же карте)
qm set 100 --hostpci1 01:00.1

# Добавляем USB контроллер для мыши
am set 100 --usb0 host=046d:c53f
```

VNC для удаленного доступа + GPU для вычислений
```bash
# Обычно конфилктуют!!
qm set 100 --vga std --hostpci0 01:00.0
```

## Оптимизация производительности
---

```bash
# Для игр/3D (с GPU passthrough)
qm set 100 --vga none --args "-device vfio-pci,host=01:00.0"
# Полное отключение виртуальной графики


# Для ускорения 2D
qm set 100 --vga qxl --memory 4096
apt install spice-vdagent  # в гостевой ОС

# Использование SPICE вместо VNC
qm set 100 --vga qxl --spice enable=1
```


## Использование
---
1. Виртуальная
*Когда не нужна 3D графика*
- Серверы без GUI
- Базовый доступ к консоли


2. Физическая
- Игровые VM
- Графические рабочие станции
- Машинное обучение (CUDA)
- Видео-рендеринг
