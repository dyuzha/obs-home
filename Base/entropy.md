---
id: entropy
aliases:
  - entropy
  - Энтропия
tags: []
---

# Энтропия
---
Мера случайности, которую питает генератор случайных чисел.


Апаратные источники:
- Timing interrupts (тайминги прерываний)
- HID events (движение мыши, нажатия клавиш)
- Disk I/O timing (время доступа к диску)
- Network packets timing (время получения пакетов)
- Hardwart RNG (специальные чипы)


Все эти данные собирает в Linux собирает:
**random driver**  - /dev/random, /dev/urandom
**rngd daemon**  - собирает энтропию с устройств
**haveged**  - генератор энтропии из таймингов CPU


Пробоемы с энтропией:
1. На серверах (без мыши/клавиатуры):
- Мало источников энтропии
- Виртуальные машины особенно страдают
- Облачные инстансы


2. В виртуальных машинах:
- Нет реального железа - нет HID событий
- Диски виртуальные - предсказуемые тайминги
- Сеть виртуальная - предсказуемые пакеты


 Решения:
 - ViryIO RNG (в Proxmox)


```bash
# Берет энтропию с хоста
qm set 100 --rng0 /dev/urandom
```
2. haveged (в гостевой ОС)
```bash
# Генерирует энтропию из таймингов CPU
apt install haveged
systemstl enable haveged
```
3. rng-tools
```bash
apt install rng-tools
# Использует /dev/hwrng если есть
```

Проверить энтропию:
```bash
# Сколько доступно прямо сейчас
cat /proc/sys/kernel/random/entropy_avail
# Хорошо: >1000, Плохо: <100

# Пул энтропии
cat /proc/sys/kernel/random/poolsize
# 4096 bits (типично)
```

Область применения:
- SSL-ключи;
- SSH-ключи;
- VPN;
- GPG;
- Дисковое шифрование:
    - LUKS;
    - BitLocker;
    - ...
- Безопасность:
    - Session IDs;
    - CSRF токены;
    - Шифрование паролей;
    - Nonces (числа одноразового использования);
    - ...
- Приложения:
- Базы данных (PostrgeSQL, MySQL, ...);
- Веб-серверы (Apache, NginX, ...);
- Языки программирования (функции: random(), rand(), ...);
- ...


