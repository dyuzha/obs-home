---
id: fail2ban
aliases: []
tags: []
---

**Back**
    [[!Lin]]

# Fail to ban
---
Fail2Ban — это утилита для защиты серверов от атак методом перебора (брутфорса). Она анализирует логи сервисов (SSH, FTP, Apache, Nginx и др.), обнаруживает подозрительные попытки входа (например, множественные неверные пароли) и автоматически блокирует злоумышленников с помощью firewall (iptables/nftables) или системных правил (например, TCP Wrappers).

## Как работает?
---
1. Мониторинг логов
2. Фильтрация атак
3. Блокировка нарушителей
4. Автоматическая разблокировка

## Основные команды
---

```bash
# Показать активные jail'ы (защищенные сервисы)
fail2ban-client status

# Статус блокировок для ssh
fail2ban-client status sshd

# Разблокировать IP вручную
fail2ban-client set sshd unbanip <ip>

# Перезагрузить конфигурацию
fail2ban-client reload

# Перезапустить сервис
systemctl restart fail2ban
```

## Настройка
---
```bash
# Основной конфиг
/etc/fail2ban/jail.conf

# Пользовательские настройки
/etc/fail2ban/jail.local

# Фильтры для сервисов
/etc/fail2ban/filter.d/

# Логи
/var/log/fail2ban.log
```

## Заметки
---
При запуске на proxmox ve отказывался работать, (не была определена переменная `sshd_log`)
В результате решением выступило закоментирование данной строчки

```bash
# logpath = %(sshd_log)s

# Данная строчка позволяет исопльзовать логи из journald
backend = %(sshd_backend)s
```

